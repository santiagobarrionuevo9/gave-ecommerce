<!-- src/app/product/detailproduct/detailproduct.component.html -->

<!-- TOAST / ALERTA FLOTANTE -->
<div *ngIf="toast()" class="position-fixed top-0 end-0 p-3" style="z-index:1080">
  <div class="toast show shadow border-0"
       [ngClass]="{'text-bg-success': toast()?.type === 'success',
                   'text-bg-danger':  toast()?.type === 'danger'}">
    <div class="d-flex align-items-center px-3 py-2">
      <div class="me-3">{{ toast()?.text }}</div>
      <button type="button" class="btn-close btn-close-white ms-auto" aria-label="Close"
              (click)="clearToast()"></button>
    </div>
  </div>
</div>

<div class="container py-4" *ngIf="!loading(); else loadingTpl">
  <ng-container *ngIf="!error; else errorTpl">

    <div class="row g-4">
      <!-- Galería simple -->
      <div class="col-12 col-lg-6">
        <img [src]="mainImage()" class="img-fluid rounded shadow-sm mb-3" [alt]="product.name" />

        <div class="d-flex gap-2 flex-wrap">
          <img *ngFor="let img of images; trackBy: trackByImgId"
               [src]="img.url"
               class="rounded border"
               style="width:90px; height:90px; object-fit:cover; cursor:pointer"
               (click)="selectAsMain(img)"
               [alt]="img.altText || product.name">
        </div>
      </div>

      <!-- Info -->
      <div class="col-12 col-lg-6">
        <h3 class="mb-2">{{ product.name }}</h3>
        <div class="text-muted mb-3" *ngIf="product?.shortDesc">{{ product.shortDesc }}</div>

        <div class="h4 fw-semibold mb-1">$ {{ product.price | number:'1.0-0' }}</div>
        <div class="mb-3" [class.text-danger]="product.stock===0" [class.text-success]="product.stock>0">
          Stock: {{ product.stock }}
        </div>

        <div class="d-flex align-items-center gap-2 mb-3">
          <input type="number" class="form-control" style="max-width:110px"
                 [(ngModel)]="qty" min="1" (keyup.enter)="addToCart()">
          <button class="btn btn-primary btn-lg"
                  [disabled]="product.stock===0"
                  (click)="addToCart()">
            Agregar al carrito
          </button>
        </div>

        <div class="mt-3">
          <h6>Descripción</h6>
          <p class="mb-0" style="white-space:pre-line">{{ product.description || '—' }}</p>
        </div>

        <div class="mt-3">
          <small class="text-muted">SKU: {{ product.sku }}</small>
        </div>
      </div>
    </div>

  </ng-container>
</div>

<ng-template #loadingTpl>
  <div class="container py-4">
    <div class="alert alert-info">Cargando producto…</div>
  </div>
</ng-template>

<ng-template #errorTpl>
  <div class="container py-4">
    <div class="alert alert-danger">{{ error }}</div>
    <a routerLink="/catalogo" class="btn btn-outline-secondary mt-2">Volver al catálogo</a>
  </div>
</ng-template>
